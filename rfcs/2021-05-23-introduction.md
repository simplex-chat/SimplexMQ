# SMP agent introduction

## Problem

Allow one agent client connect two connections it has directly, acting as an out-of-band channel.

It can be used both separately, as part of some client functionality, and as part of group protocol.

## Solution

A protocol with commands and message envelopes to exchange the information between parties to establish connection.

### Commands and messages

Below commands are for the scenario when A introduces B to M.

- command `C:idAB INTRO C:idAM infoM` - introduce connection cIdB to connection cIdM (response is `C:idAB OK`)
- message `C:idBA REQ intro:invId infoM` - notification to confirm introduction
- command `C:idBM? ACPT intro:invId` - accept offer to be introduced (response is `C:idBM OK`, followed by `C:idBM CON`)
- message `C:idBM CON` - confirmation that connection is established to both introduced parties
- message `C:idAB CON C:idAM` - confirmation that connection is established to the introducer

### Agent envelopes

- `INTRO c:extIntroIdM infoM` - new introduction offered by introducer
- `INV c:extIntroIdB prv:idBMInv infoB` - invitation to join connection from B to M sent via A
- `REQ c:extIntroIdB prv:idBMInv infoB` - new introduction forwarded by introducer
- `CON c:extIntroIdM` - confirmation that the connection is established sent by both introduced parties to the introducer

## Namespace

Given that the introduction objects are short lived, they should not reuse the same commands or share the same namespace as connections, broadcasts and groups, but they probably should share the namespace with group and connection invitations.

## Introduction protocol costs

4 messages + cost to establish a connection


The [sequence digram for introduction](https://mermaid-js.github.io/mermaid-live-editor/#/view/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gIHBhcnRpY2lwYW50IEEgYXMgQWxpY2UgKEEpIC0gdGhlIGludHJvZHVjZXJcbiAgcGFydGljaXBhbnQgQUEgYXMgQWxpY2Unczxicj5hZ2VudCAoQUEpXG4gIHBhcnRpY2lwYW50IEIgYXMgQm9iIChCKSAtIGludHJvZHVjZWRcbiAgcGFydGljaXBhbnQgQkEgYXMgQm9iJ3M8YnI-YWdlbnQgKEJBKVxuICBwYXJ0aWNpcGFudCBNIGFzIE1hcmsgKE0pIC0gaW50cm9kdWNlZCB0b1xuICBwYXJ0aWNpcGFudCBNQSBhcyBNYXJrJ3M8YnI-YWdlbnQgKE1BKVxuXG4gIG5vdGUgb3ZlciBBLCBBQTogMS4gY3JlYXRlIGludHJvZHVjdGlvblxuICBBIC0-PiBBQTogaWRBQiBJTkVXIGlkQU0gaW5mb008YnI-KGlkQUIgLSBjb25uIGFsaWFzIEEgaGFzIGZvciBCLDxicj5pZEFNIC0gZm9yIE0pXG4gIEFBIC0-PiBBOiBpZEFCIE9LXG5cbiAgbm90ZSBvdmVyIEEsIEJBOiAyLiBzZW5kIGludHJvIHRvIEJvYlxuXG4gIEFBIC0-PiBCQTogdmlhIGlkQUI6IElfTkVXIGV4dEludHJvSWRCICBpbmZvTVxuICBCQSAtPj4gQjogaWRCQSBJQ09ORiBpbnRJbnRyb0lkQiBpbmZvTVxuICBCIC0-PiBCQTogaWRCQSBJTEVUIGludEludHJvSWRCXG4gIEJBIC0-PiBCOiBpZEJBIE9LXG5cbiAgbm90ZSBvdmVyIEJBOiAzLiBjcmVhdGUgY29ubmVjdGlvbiBmb3IgIE0gaWRCTVxuXG4gIEJBIC0-PiBBQTogdmlhIGlkQkE6IElfSU5WIGV4dEludHJvSWRCIGlkQk1JbnYgaW5mb0JcblxuICBub3RlIG92ZXIgQUEsIE06IDQuIHNlbmQgaW50cm8gdG8gTWFya1xuXG4gIEFBIC0-PiBNQTogdmlhIGlkQU06IElfTkVXIGV4dEludHJvSWRNIGlkQk1JbnYgaW5mb0JcblxuICBub3RlIG92ZXIgTUEsIEI6IDUuIE1hcmsgY29ubmVjdHMgdG8gQm9iXG5cbiAgTUEgLT4-IE06IGlkTUEgSUNPTkYgaW50SW50cm9JZE0gaW5mb0JcbiAgTSAtPj4gTUE6IGlkTUI_IElMRVQgaW50SW50cm9JZE1cblxuICBNQSAtPj4gQkE6ICBlc3RhYmxpc2ggY29ubmVjdGlvbiBpZEJNIC0-IGlkTUJcblxuICBub3RlIG92ZXIgQSwgTUE6IDYuIG5vdGlmeSBhbGwgY2xpZW50c1xuXG4gIE1BIC0-PiBNOiBpZE1CIElDT04gaW50SW50cm9JZE1cbiAgQkEgLT4-IEI6IGlkQk0gSUNPTiBpbnRJbnRyb0lkQlxuICBNQSAtPj4gQUE6IHZpYSBpZE1BIElfQ09OIGV4dEludHJvSWRNXG4gIEJBIC0-PiBBQTogdmlhIGlkQkEgSV9DT04gZXh0SW50cm9JZEJcbiAgQUEgLT4-IEE6IGlkQUIgSURPTkUgaWRBTVxuIiwibWVybWFpZCI6e30sInVwZGF0ZUVkaXRvciI6ZmFsc2V9), the source is [here](./intro.mmd).

![sequence digram for introduction](https://mermaid.ink/svg/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gIHBhcnRpY2lwYW50IEEgYXMgQWxpY2UgKEEpIC0gdGhlIGludHJvZHVjZXJcbiAgcGFydGljaXBhbnQgQUEgYXMgQWxpY2Unczxicj5hZ2VudCAoQUEpXG4gIHBhcnRpY2lwYW50IEIgYXMgQm9iIChCKSAtIGludHJvZHVjZWRcbiAgcGFydGljaXBhbnQgQkEgYXMgQm9iJ3M8YnI-YWdlbnQgKEJBKVxuICBwYXJ0aWNpcGFudCBNIGFzIE1hcmsgKE0pIC0gaW50cm9kdWNlZCB0b1xuICBwYXJ0aWNpcGFudCBNQSBhcyBNYXJrJ3M8YnI-YWdlbnQgKE1BKVxuXG4gIG5vdGUgb3ZlciBBLCBBQTogMS4gY3JlYXRlIGludHJvZHVjdGlvblxuICBBIC0-PiBBQTogaWRBQiBJTkVXIGlkQU0gaW5mb008YnI-KGlkQUIgLSBjb25uIGFsaWFzIEEgaGFzIGZvciBCLDxicj5pZEFNIC0gZm9yIE0pXG4gIEFBIC0-PiBBOiBpZEFCIE9LXG5cbiAgbm90ZSBvdmVyIEEsIEJBOiAyLiBzZW5kIGludHJvIHRvIEJvYlxuXG4gIEFBIC0-PiBCQTogdmlhIGlkQUI6IElfTkVXIGV4dEludHJvSWRCICBpbmZvTVxuICBCQSAtPj4gQjogaWRCQSBJQ09ORiBpbnRJbnRyb0lkQiBpbmZvTVxuICBCIC0-PiBCQTogaWRCQSBJTEVUIGludEludHJvSWRCXG4gIEJBIC0-PiBCOiBpZEJBIE9LXG5cbiAgbm90ZSBvdmVyIEJBOiAzLiBjcmVhdGUgY29ubmVjdGlvbiBmb3IgIE0gaWRCTVxuXG4gIEJBIC0-PiBBQTogdmlhIGlkQkE6IElfSU5WIGV4dEludHJvSWRCIGlkQk1JbnYgaW5mb0JcblxuICBub3RlIG92ZXIgQUEsIE06IDQuIHNlbmQgaW50cm8gdG8gTWFya1xuXG4gIEFBIC0-PiBNQTogdmlhIGlkQU06IElfTkVXIGV4dEludHJvSWRNIGlkQk1JbnYgaW5mb0JcblxuICBub3RlIG92ZXIgTUEsIEI6IDUuIE1hcmsgY29ubmVjdHMgdG8gQm9iXG5cbiAgTUEgLT4-IE06IGlkTUEgSUNPTkYgaW50SW50cm9JZE0gaW5mb0JcbiAgTSAtPj4gTUE6IGlkTUI_IElMRVQgaW50SW50cm9JZE1cblxuICBNQSAtPj4gQkE6ICBlc3RhYmxpc2ggY29ubmVjdGlvbiBpZEJNIC0-IGlkTUJcblxuICBub3RlIG92ZXIgQSwgTUE6IDYuIG5vdGlmeSBhbGwgY2xpZW50c1xuXG4gIE1BIC0-PiBNOiBpZE1CIElDT04gaW50SW50cm9JZE1cbiAgQkEgLT4-IEI6IGlkQk0gSUNPTiBpbnRJbnRyb0lkQlxuICBNQSAtPj4gQUE6IHZpYSBpZE1BIElfQ09OIGV4dEludHJvSWRNXG4gIEJBIC0-PiBBQTogdmlhIGlkQkEgSV9DT04gZXh0SW50cm9JZEJcbiAgQUEgLT4-IEE6IGlkQUIgSURPTkUgaWRBTVxuIiwibWVybWFpZCI6e30sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)
